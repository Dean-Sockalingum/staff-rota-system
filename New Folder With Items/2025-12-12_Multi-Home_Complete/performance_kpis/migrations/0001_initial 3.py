# Generated by Django 4.2.27 on 2026-01-14 16:39

from django.conf import settings
from django.db import migrations, models
import django.db.models.deletion


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
        ('scheduling', '0058_alter_user_sms_notifications_enabled'),
    ]

    operations = [
        migrations.CreateModel(
            name='BalancedScorecardPerspective',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100, unique=True)),
                ('description', models.TextField()),
                ('strategic_objective', models.TextField(help_text='High-level strategic objective for this perspective')),
                ('display_order', models.IntegerField(default=0)),
                ('icon_class', models.CharField(blank=True, help_text='CSS icon class for dashboard display', max_length=50)),
                ('color_code', models.CharField(default='#007bff', help_text='Hex color code for visual identification', max_length=7)),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'verbose_name': 'Balanced Scorecard Perspective',
                'verbose_name_plural': 'Balanced Scorecard Perspectives',
                'ordering': ['display_order', 'name'],
            },
        ),
        migrations.CreateModel(
            name='DashboardKPI',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('display_order', models.IntegerField(default=0)),
                ('chart_type', models.CharField(choices=[('GAUGE', 'Gauge Chart'), ('LINE', 'Line Chart'), ('BAR', 'Bar Chart'), ('AREA', 'Area Chart'), ('NUMBER', 'Number Only')], default='GAUGE', max_length=20)),
                ('show_trend', models.BooleanField(default=True, help_text='Show trend indicator')),
                ('show_target', models.BooleanField(default=True, help_text='Show target line/value')),
                ('time_range_days', models.IntegerField(default=90, help_text='Number of days of historical data to display')),
            ],
            options={
                'verbose_name': 'Dashboard KPI',
                'verbose_name_plural': 'Dashboard KPIs',
                'ordering': ['display_order'],
            },
        ),
        migrations.CreateModel(
            name='KPIDefinition',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('code', models.CharField(help_text='Unique KPI identifier (e.g., KPI-FIN-001)', max_length=20, unique=True)),
                ('name', models.CharField(help_text='Short KPI name', max_length=200)),
                ('description', models.TextField(help_text='Detailed description of what this KPI measures')),
                ('category', models.CharField(choices=[('FINANCIAL', 'Financial'), ('CUSTOMER', 'Customer/Service User'), ('INTERNAL', 'Internal Processes'), ('LEARNING', 'Learning & Growth'), ('QUALITY', 'Quality & Safety'), ('COMPLIANCE', 'Compliance & Regulatory'), ('WORKFORCE', 'Workforce & Staffing')], help_text='Balanced Scorecard category', max_length=20)),
                ('measurement_type', models.CharField(choices=[('PERCENTAGE', 'Percentage (%)'), ('COUNT', 'Count (Number)'), ('CURRENCY', 'Currency (Â£)'), ('HOURS', 'Hours'), ('DAYS', 'Days'), ('RATIO', 'Ratio'), ('SCORE', 'Score')], help_text='Type of measurement', max_length=20)),
                ('trend_direction', models.CharField(choices=[('HIGHER_BETTER', 'Higher is Better'), ('LOWER_BETTER', 'Lower is Better'), ('TARGET_RANGE', 'Within Target Range')], help_text='Desired trend direction', max_length=20)),
                ('calculation_formula', models.TextField(blank=True, help_text='Formula or method for calculating this KPI')),
                ('data_source', models.CharField(blank=True, help_text='Source system or data for this KPI', max_length=200)),
                ('target_value', models.DecimalField(blank=True, decimal_places=2, help_text='Target value for this KPI', max_digits=10, null=True)),
                ('threshold_red', models.DecimalField(blank=True, decimal_places=2, help_text='Red threshold (performance concern)', max_digits=10, null=True)),
                ('threshold_amber', models.DecimalField(blank=True, decimal_places=2, help_text='Amber threshold (needs improvement)', max_digits=10, null=True)),
                ('threshold_green', models.DecimalField(blank=True, decimal_places=2, help_text='Green threshold (meets target)', max_digits=10, null=True)),
                ('reporting_frequency', models.CharField(choices=[('DAILY', 'Daily'), ('WEEKLY', 'Weekly'), ('MONTHLY', 'Monthly'), ('QUARTERLY', 'Quarterly'), ('ANNUALLY', 'Annually')], default='MONTHLY', max_length=20)),
                ('is_active', models.BooleanField(default=True)),
                ('display_on_dashboard', models.BooleanField(default=True, help_text='Show this KPI on executive dashboards')),
                ('display_order', models.IntegerField(default=0, help_text='Order for dashboard display')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_kpi_definitions', to=settings.AUTH_USER_MODEL)),
                ('responsible_owner', models.ForeignKey(help_text='Person responsible for this KPI', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='owned_kpis', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'KPI Definition',
                'verbose_name_plural': 'KPI Definitions',
                'ordering': ['category', 'display_order', 'name'],
            },
        ),
        migrations.CreateModel(
            name='ExecutiveDashboard',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=200)),
                ('description', models.TextField(blank=True)),
                ('layout', models.CharField(choices=[('GRID', 'Grid Layout'), ('LIST', 'List Layout'), ('BALANCED_SCORECARD', 'Balanced Scorecard')], default='GRID', max_length=20)),
                ('refresh_interval', models.IntegerField(default=300, help_text='Auto-refresh interval in seconds (0 = manual only)')),
                ('is_public', models.BooleanField(default=False, help_text='Make this dashboard visible to all users?')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('last_viewed', models.DateTimeField(blank=True, null=True)),
                ('care_homes', models.ManyToManyField(blank=True, help_text='Filter to specific care homes (empty = all homes)', related_name='exec_dashboards', to='scheduling.carehome')),
                ('kpis', models.ManyToManyField(related_name='exec_dashboards', through='performance_kpis.DashboardKPI', to='performance_kpis.kpidefinition')),
                ('owner', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='executive_dashboards', to=settings.AUTH_USER_MODEL)),
                ('shared_with', models.ManyToManyField(blank=True, help_text='Specific users with access to this dashboard', related_name='shared_dashboards', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Executive Dashboard',
                'verbose_name_plural': 'Executive Dashboards',
                'ordering': ['name'],
            },
        ),
        migrations.AddField(
            model_name='dashboardkpi',
            name='dashboard',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='performance_kpis.executivedashboard'),
        ),
        migrations.AddField(
            model_name='dashboardkpi',
            name='kpi',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='performance_kpis.kpidefinition'),
        ),
        migrations.CreateModel(
            name='PerformanceTarget',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('target_period', models.CharField(choices=[('DAILY', 'Daily'), ('WEEKLY', 'Weekly'), ('MONTHLY', 'Monthly'), ('QUARTERLY', 'Quarterly'), ('ANNUALLY', 'Annually')], default='QUARTERLY', max_length=20)),
                ('period_start', models.DateField()),
                ('period_end', models.DateField()),
                ('target_value', models.DecimalField(decimal_places=2, max_digits=10)),
                ('stretch_target', models.DecimalField(blank=True, decimal_places=2, help_text='Aspirational stretch goal', max_digits=10, null=True)),
                ('minimum_acceptable', models.DecimalField(blank=True, decimal_places=2, help_text='Minimum acceptable performance level', max_digits=10, null=True)),
                ('strategic_objective', models.TextField(blank=True, help_text='Link to organizational strategic objective')),
                ('action_plan', models.TextField(blank=True, help_text='Actions planned to achieve this target')),
                ('status', models.CharField(choices=[('DRAFT', 'Draft'), ('APPROVED', 'Approved'), ('ACTIVE', 'Active'), ('ACHIEVED', 'Achieved'), ('NOT_ACHIEVED', 'Not Achieved'), ('CANCELLED', 'Cancelled')], default='DRAFT', max_length=20)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('approved_at', models.DateTimeField(blank=True, null=True)),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='approved_targets', to=settings.AUTH_USER_MODEL)),
                ('care_home', models.ForeignKey(blank=True, help_text='Specific care home (null for organization-wide targets)', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='performance_targets', to='scheduling.carehome')),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_targets', to=settings.AUTH_USER_MODEL)),
                ('kpi', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='targets', to='performance_kpis.kpidefinition')),
            ],
            options={
                'verbose_name': 'Performance Target',
                'verbose_name_plural': 'Performance Targets',
                'ordering': ['-period_start'],
                'indexes': [models.Index(fields=['kpi', 'period_start', 'period_end'], name='performance_kpi_id_814798_idx'), models.Index(fields=['status'], name='performance_status_d28e02_idx')],
            },
        ),
        migrations.CreateModel(
            name='KPIMeasurement',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('measurement_date', models.DateField(help_text='Date of measurement')),
                ('period_start', models.DateField(blank=True, help_text='Start of measurement period (for weekly/monthly KPIs)', null=True)),
                ('period_end', models.DateField(blank=True, help_text='End of measurement period', null=True)),
                ('actual_value', models.DecimalField(decimal_places=2, help_text='Actual measured value', max_digits=10)),
                ('target_value', models.DecimalField(blank=True, decimal_places=2, help_text='Target value for this period (if different from KPI default)', max_digits=10, null=True)),
                ('variance', models.DecimalField(blank=True, decimal_places=2, help_text='Variance from target (calculated)', max_digits=10, null=True)),
                ('variance_percentage', models.DecimalField(blank=True, decimal_places=2, help_text='Variance as percentage of target', max_digits=7, null=True)),
                ('rag_status', models.CharField(choices=[('GREEN', 'Green - Meets Target'), ('AMBER', 'Amber - Needs Improvement'), ('RED', 'Red - Performance Concern'), ('UNKNOWN', 'Unknown')], default='UNKNOWN', max_length=10)),
                ('numerator', models.DecimalField(blank=True, decimal_places=2, help_text='Numerator for calculated KPIs (e.g., number of incidents)', max_digits=10, null=True)),
                ('denominator', models.DecimalField(blank=True, decimal_places=2, help_text='Denominator for calculated KPIs (e.g., total shifts)', max_digits=10, null=True)),
                ('notes', models.TextField(blank=True, help_text='Commentary on performance')),
                ('recorded_at', models.DateTimeField(auto_now_add=True)),
                ('verified', models.BooleanField(default=False, help_text='Has this measurement been verified by management?')),
                ('verified_at', models.DateTimeField(blank=True, null=True)),
                ('care_home', models.ForeignKey(blank=True, help_text='Specific care home (null for organization-wide KPIs)', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='kpi_measurements', to='scheduling.carehome')),
                ('kpi', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='measurements', to='performance_kpis.kpidefinition')),
                ('recorded_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='recorded_measurements', to=settings.AUTH_USER_MODEL)),
                ('verified_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='verified_measurements', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'KPI Measurement',
                'verbose_name_plural': 'KPI Measurements',
                'ordering': ['-measurement_date', 'kpi'],
                'indexes': [models.Index(fields=['kpi', '-measurement_date'], name='performance_kpi_id_654c16_idx'), models.Index(fields=['care_home', '-measurement_date'], name='performance_care_ho_0e3dd1_idx'), models.Index(fields=['measurement_date'], name='performance_measure_486fcf_idx'), models.Index(fields=['rag_status'], name='performance_rag_sta_ffb944_idx')],
                'unique_together': {('kpi', 'care_home', 'measurement_date')},
            },
        ),
        migrations.AlterUniqueTogether(
            name='dashboardkpi',
            unique_together={('dashboard', 'kpi')},
        ),
        migrations.CreateModel(
            name='BenchmarkData',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('source_name', models.CharField(help_text='Source of benchmark data (e.g., CQC, SSSC, Industry Survey)', max_length=200)),
                ('source_description', models.TextField(blank=True)),
                ('benchmark_type', models.CharField(choices=[('NATIONAL', 'National Average'), ('REGIONAL', 'Regional Average'), ('SECTOR', 'Sector Average'), ('TOP_QUARTILE', 'Top Quartile'), ('BEST_IN_CLASS', 'Best in Class'), ('REGULATORY', 'Regulatory Standard')], default='NATIONAL', max_length=20)),
                ('period_start', models.DateField()),
                ('period_end', models.DateField()),
                ('benchmark_value', models.DecimalField(decimal_places=2, help_text='Benchmark comparison value', max_digits=10)),
                ('sample_size', models.IntegerField(blank=True, help_text='Number of organizations in benchmark sample', null=True)),
                ('methodology', models.TextField(blank=True, help_text='How the benchmark was calculated')),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('kpi', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='benchmarks', to='performance_kpis.kpidefinition')),
            ],
            options={
                'verbose_name': 'Benchmark Data',
                'verbose_name_plural': 'Benchmark Data',
                'ordering': ['-period_start', 'kpi'],
                'indexes': [models.Index(fields=['kpi', 'period_start'], name='performance_kpi_id_4572f0_idx'), models.Index(fields=['benchmark_type'], name='performance_benchma_54f4b4_idx')],
            },
        ),
    ]
