{% extends "base.html" %}
{% load static %}

{% block title %}{{ page_title }} - DLP Staff Rota{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <div class="row mb-4">
        <div class="col-md-8">
            <h2><i class="fas fa-clipboard-check"></i> {{ page_title }}</h2>
        </div>
        <div class="col-md-4 text-right">
            <a href="{% url 'experience_feedback:survey_list' %}" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left"></i> Back to List
            </a>
        </div>
    </div>

    <!-- Survey Details -->
    <div class="card mb-4">
        <div class="card-header bg-primary text-white">
            <h5>Survey Information</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <p><strong>Type:</strong> {{ survey.get_survey_type_display }}</p>
                    <p><strong>Date:</strong> {{ survey.survey_date|date:"d M Y" }}</p>
                    <p><strong>Care Home:</strong> {{ survey.care_home.name }}</p>
                </div>
                <div class="col-md-6">
                    <p><strong>Respondent:</strong> {% if survey.is_anonymous %}<em>Anonymous</em>{% else %}{{ survey.respondent_name }}{% endif %}</p>
                    <p><strong>Relationship:</strong> {{ survey.relationship_to_resident|default:"-" }}</p>
                    {% if survey.resident %}
                    <p><strong>Resident:</strong> {{ survey.resident.full_name }}</p>
                    {% endif %}
                </div>
            </div>
            
            <hr>
            
            <div class="row">
                <div class="col-md-6">
                    <h5>Average Score</h5>
                    <div class="display-4 text-primary">{{ avg_score|floatformat:2 }}<span class="h5 text-muted">/5.0</span></div>
                </div>
                <div class="col-md-6">
                    <h5>Net Promoter Score</h5>
                    {% if survey.likelihood_recommend %}
                    <div class="display-4 {% if nps_category == 'PROMOTER' %}text-success{% elif nps_category == 'PASSIVE' %}text-warning{% else %}text-danger{% endif %}">
                        {{ survey.likelihood_recommend }}<span class="h5 text-muted">/10</span>
                    </div>
                    <p class="text-muted">{{ nps_category }}</p>
                    {% else %}
                    <p class="text-muted">Not provided</p>
                    {% endif %}
                </div>
            </div>

            <hr>

            <h5>Dimension Scores</h5>
            <div class="row">
                <div class="col-md-6">
                    <p><strong>Quality of Care:</strong> {{ survey.quality_of_care|default:"-" }}/5</p>
                    <p><strong>Staff Attitude:</strong> {{ survey.staff_attitude|default:"-" }}/5</p>
                    <p><strong>Communication:</strong> {{ survey.communication|default:"-" }}/5</p>
                    <p><strong>Environment & Cleanliness:</strong> {{ survey.environment_cleanliness|default:"-" }}/5</p>
                </div>
                <div class="col-md-6">
                    <p><strong>Meals & Nutrition:</strong> {{ survey.meals_nutrition|default:"-" }}/5</p>
                    <p><strong>Activities & Engagement:</strong> {{ survey.activities_engagement|default:"-" }}/5</p>
                    <p><strong>Dignity & Respect:</strong> {{ survey.dignity_respect|default:"-" }}/5</p>
                    <p><strong>Safety & Security:</strong> {{ survey.safety_security|default:"-" }}/5</p>
                </div>
            </div>

            {% if survey.what_works_well %}
            <hr>
            <h5>What Works Well</h5>
            <p>{{ survey.what_works_well }}</p>
            {% endif %}

            {% if survey.areas_for_improvement %}
            <hr>
            <h5>Areas for Improvement</h5>
            <p>{{ survey.areas_for_improvement }}</p>
            {% endif %}

            {% if survey.additional_comments %}
            <hr>
            <h5>Additional Comments</h5>
            <p>{{ survey.additional_comments }}</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}